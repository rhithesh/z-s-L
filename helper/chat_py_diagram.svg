<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="CLASS" height="950px" preserveAspectRatio="none" style="width:1650px;height:950px;background:#FFFFFF;" version="1.1" viewBox="0 0 1650 950" width="1650px" zoomAndPan="magnify"><title>Chat.py Architecture</title><defs/><g><g class="title" data-source-line="1"><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="147.2188" x="744.7789" y="23.5352">Chat.py Architecture</text></g><!--cluster helper--><g class="cluster" data-entity="helper" data-source-line="3" data-uid="ent0002" id="cluster_helper"><path d="M8.5,335.9283 L55.2939,335.9283 A3.75,3.75 0 0 1 57.7939,338.4283 L64.7939,358.4166 L654.5,358.4166 A2.5,2.5 0 0 1 657,360.9166 L657,932.9283 A2.5,2.5 0 0 1 654.5,935.4283 L8.5,935.4283 A2.5,2.5 0 0 1 6,932.9283 L6,338.4283 A2.5,2.5 0 0 1 8.5,335.9283" fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="6" x2="64.7939" y1="358.4166" y2="358.4166"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="45.7939" x="10" y="351.4634">helper</text></g><!--cluster parent--><g class="cluster" data-entity="parent" data-source-line="35" data-uid="ent0005" id="cluster_parent"><path d="M683.5,696.2783 L731.4424,696.2783 A3.75,3.75 0 0 1 733.9424,698.7783 L740.9424,718.7666 L930.5,718.7666 A2.5,2.5 0 0 1 933,721.2666 L933,941.1683 A2.5,2.5 0 0 1 930.5,943.6683 L683.5,943.6683 A2.5,2.5 0 0 1 681,941.1683 L681,698.7783 A2.5,2.5 0 0 1 683.5,696.2783" fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="681" x2="740.9424" y1="718.7666" y2="718.7666"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="46.9424" x="685" y="711.8134">parent</text></g><!--cluster mcp--><g class="cluster" data-entity="mcp" data-source-line="51" data-uid="ent0007" id="cluster_mcp"><path d="M959.5,737.4983 L990.8037,737.4983 A3.75,3.75 0 0 1 993.3037,739.9983 L1000.3037,759.9866 L1436.5,759.9866 A2.5,2.5 0 0 1 1439,762.4866 L1439,899.9483 A2.5,2.5 0 0 1 1436.5,902.4483 L959.5,902.4483 A2.5,2.5 0 0 1 957,899.9483 L957,739.9983 A2.5,2.5 0 0 1 959.5,737.4983" fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="957" x2="1000.3037" y1="759.9866" y2="759.9866"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="30.3037" x="961" y="753.0334">mcp</text></g><!--cluster API--><g class="cluster" data-entity="API" data-source-line="62" data-uid="ent0009" id="cluster_API"><path d="M91.5,43.4883 L116.0361,43.4883 A3.75,3.75 0 0 1 118.5361,45.9883 L125.5361,65.9766 L394.5,65.9766 A2.5,2.5 0 0 1 397,68.4766 L397,222.4283 A2.5,2.5 0 0 1 394.5,224.9283 L91.5,224.9283 A2.5,2.5 0 0 1 89,222.4283 L89,45.9883 A2.5,2.5 0 0 1 91.5,43.4883" fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="89" x2="125.5361" y1="65.9766" y2="65.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="23.5361" x="93" y="59.0234">API</text></g><!--class Helper--><g class="entity" data-entity="Helper" data-source-line="5" data-uid="ent0003" id="entity_Helper"><rect fill="#F1F1F1" height="262.3477" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="405.3604" x="22.32" y="370.9283"/><ellipse cx="198.5129" cy="386.9283" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1;"/><path d="M200.986,393.0713 Q200.405,393.3702 199.7658,393.5196 Q199.1266,393.669 198.4211,393.669 Q195.9142,393.669 194.5944,392.0171 Q193.2746,390.3653 193.2746,387.2442 Q193.2746,384.1148 194.5944,382.4629 Q195.9142,380.8111 198.4211,380.8111 Q199.1266,380.8111 199.7741,380.9605 Q200.4216,381.1099 200.986,381.4087 L200.986,384.1314 Q200.3552,383.5504 199.7617,383.2806 Q199.1681,383.0108 198.5373,383.0108 Q197.1926,383.0108 196.5077,384.0775 Q195.8229,385.1441 195.8229,387.2442 Q195.8229,389.336 196.5077,390.4026 Q197.1926,391.4693 198.5373,391.4693 Q199.1681,391.4693 199.7617,391.1995 Q200.3552,390.9297 200.986,390.3487 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44.4746" x="219.0129" y="392.2193">Helper</text><line style="stroke:#181818;stroke-width:0.5;" x1="23.32" x2="426.6804" y1="402.9283" y2="402.9283"/><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1;" width="6" x="30.32" y="413.6724"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="124.5303" x="42.32" y="420.4634">main: DMSLMMain</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1;" width="6" x="30.32" y="430.1607"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="379.3604" x="42.32" y="436.9517">url: str = "http://127.0.0.1:5000/v1/chat/completions"</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1;" width="6" x="30.32" y="446.649"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="272.9385" x="42.32" y="453.44">model: str = "google/gemma-3-12b-it"</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1;" width="6" x="30.32" y="463.1373"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="150.8896" x="42.32" y="469.9283">mcp_client: MCPClient</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1;" width="6" x="30.32" y="479.6255"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="174.043" x="42.32" y="486.4166">mcp: Optional[MCPClient]</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="42.32" y="502.9048">&#160;</text><line style="stroke:#181818;stroke-width:1;" x1="23.32" x2="426.6804" y1="509.858" y2="509.858"/><ellipse cx="33.32" cy="523.6021" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="183.6543" x="42.32" y="527.3931">__init__(main: DMSLMMain)</text><ellipse cx="33.32" cy="540.0904" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="289.4883" x="42.32" y="543.8814">_play_wav(filename: str, time_of_file: float)</text><ellipse cx="33.32" cy="556.5787" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="311.9717" x="42.32" y="560.3697">extract_tool_block(response: str) -&gt; (str, dict)</text><ellipse cx="33.32" cy="573.067" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="127.5586" x="42.32" y="576.858">start_mcp() : async</text><ellipse cx="33.32" cy="589.5552" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="291.7988" x="42.32" y="593.3462">tool_check_CALL(full_response: str) : async</text><ellipse cx="33.32" cy="606.0435" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="215.332" x="42.32" y="609.8345">get_mcp() -&gt; MCPClient : async</text><ellipse cx="33.32" cy="622.5318" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="212.1191" x="42.32" y="626.3228">chatLLM(messages: list) : async</text></g><!--class StreamProcessor--><g class="entity" data-entity="StreamProcessor" data-source-line="22" data-uid="ent0004" id="entity_StreamProcessor"><rect fill="#F1F1F1" height="179.9063" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="314.0869" x="261.96" y="739.5183"/><ellipse cx="358.3809" cy="755.5183" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1;"/><path d="M360.854,761.6613 Q360.273,761.9602 359.6338,762.1096 Q358.9947,762.259 358.2891,762.259 Q355.7823,762.259 354.4624,760.6071 Q353.1426,758.9553 353.1426,755.8342 Q353.1426,752.7048 354.4624,751.0529 Q355.7823,749.4011 358.2891,749.4011 Q358.9947,749.4011 359.6421,749.5505 Q360.2896,749.6999 360.854,749.9988 L360.854,752.7214 Q360.2232,752.1404 359.6297,751.8706 Q359.0362,751.6008 358.4053,751.6008 Q357.0606,751.6008 356.3758,752.6675 Q355.691,753.7341 355.691,755.8342 Q355.691,757.926 356.3758,758.9926 Q357.0606,760.0593 358.4053,760.0593 Q359.0362,760.0593 359.6297,759.7895 Q360.2232,759.5197 360.854,758.9387 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112.7451" x="378.8809" y="760.8093">StreamProcessor</text><line style="stroke:#181818;stroke-width:0.5;" x1="262.96" x2="575.0469" y1="771.5183" y2="771.5183"/><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1;" width="6" x="269.96" y="782.2624"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="216.9727" x="281.96" y="789.0534">stream_state: str = "UNKNOWN"</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1;" width="6" x="269.96" y="798.7507"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="148.0391" x="281.96" y="805.5417">full_response: str = ""</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1;" width="6" x="269.96" y="815.239"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="98.7314" x="281.96" y="822.03">buffer: str = ""</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="281.96" y="838.5183">&#160;</text><line style="stroke:#181818;stroke-width:1;" x1="262.96" x2="575.0469" y1="845.4714" y2="845.4714"/><ellipse cx="272.96" cy="859.2155" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="212.4883" x="281.96" y="863.0066">process_chunk(delta: str) : void</text><ellipse cx="272.96" cy="875.7038" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="217.9023" x="281.96" y="879.4948">determine_state(buffer: str) : str</text><ellipse cx="272.96" cy="892.1921" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="287.7109" x="281.96" y="895.9831">handle_tool_response(response: str) : void</text><ellipse cx="272.96" cy="908.6804" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="288.0869" x="281.96" y="912.4714">handle_text_response(response: str) : void</text></g><!--class DMSLMMain--><g class="entity" data-entity="DMSLMMain" data-source-line="37" data-uid="ent0006" id="entity_DMSLMMain"><rect fill="#F1F1F1" height="196.3945" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="220.2842" x="696.86" y="731.2783"/><ellipse cx="761.6852" cy="747.2783" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1;"/><path d="M764.1583,753.4213 Q763.5773,753.7202 762.9381,753.8696 Q762.299,754.019 761.5934,754.019 Q759.0866,754.019 757.7667,752.3671 Q756.4469,750.7153 756.4469,747.5942 Q756.4469,744.4648 757.7667,742.8129 Q759.0866,741.1611 761.5934,741.1611 Q762.299,741.1611 762.9464,741.3105 Q763.5939,741.4599 764.1583,741.7588 L764.1583,744.4814 Q763.5275,743.9004 762.934,743.6306 Q762.3405,743.3608 761.7096,743.3608 Q760.3649,743.3608 759.6801,744.4275 Q758.9953,745.4941 758.9953,747.5942 Q758.9953,749.686 759.6801,750.7526 Q760.3649,751.8193 761.7096,751.8193 Q762.3405,751.8193 762.934,751.5495 Q763.5275,751.2797 764.1583,750.6987 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82.1338" x="782.1852" y="752.5693">DMSLMMain</text><line style="stroke:#181818;stroke-width:0.5;" x1="697.86" x2="916.1442" y1="763.2783" y2="763.2783"/><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1;" width="6" x="704.86" y="774.0224"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95.8672" x="716.86" y="780.8134">messages: list</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1;" width="6" x="704.86" y="790.5107"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="170.96" x="716.86" y="797.3017">textOutputQueue: Queue</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1;" width="6" x="704.86" y="806.999"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="181.5762" x="716.86" y="813.79">piper_audio_queue: Queue</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1;" width="6" x="704.86" y="823.4873"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="125.6855" x="716.86" y="830.2783">Dataqueue: Queue</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1;" width="6" x="704.86" y="839.9755"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="138.2705" x="716.86" y="846.7666">event_queue: Queue</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1;" width="6" x="704.86" y="856.4638"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="135.4541" x="716.86" y="863.2548">UserCanSpeak: bool</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1;" width="6" x="704.86" y="872.9521"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89.4619" x="716.86" y="879.7431">session: bool</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="716.86" y="896.2314">&#160;</text><line style="stroke:#181818;stroke-width:1;" x1="697.86" x2="916.1442" y1="903.1845" y2="903.1845"/><ellipse cx="707.86" cy="916.9287" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="194.2842" x="716.86" y="920.7197">clearCacheOnEndOfSession()</text></g><!--class MCPClient--><g class="entity" data-entity="MCPClient" data-source-line="53" data-uid="ent0008" id="entity_MCPClient"><rect fill="#F1F1F1" height="113.9531" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="312.959" x="972.52" y="772.4983"/><ellipse cx="1090.2554" cy="788.4983" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1;"/><path d="M1092.7285,794.6413 Q1092.1474,794.9402 1091.5083,795.0896 Q1090.8691,795.239 1090.1636,795.239 Q1087.6567,795.239 1086.3369,793.5871 Q1085.0171,791.9353 1085.0171,788.8142 Q1085.0171,785.6848 1086.3369,784.0329 Q1087.6567,782.3811 1090.1636,782.3811 Q1090.8691,782.3811 1091.5166,782.5305 Q1092.164,782.6799 1092.7285,782.9788 L1092.7285,785.7014 Q1092.0976,785.1204 1091.5041,784.8506 Q1090.9106,784.5808 1090.2798,784.5808 Q1088.935,784.5808 1088.2502,785.6475 Q1087.5654,786.7141 1087.5654,788.8142 Q1087.5654,790.906 1088.2502,791.9726 Q1088.935,793.0393 1090.2798,793.0393 Q1090.9106,793.0393 1091.5041,792.7695 Q1092.0976,792.4997 1092.7285,791.9187 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="68.9883" x="1110.7554" y="793.7893">MCPClient</text><line style="stroke:#181818;stroke-width:0.5;" x1="973.52" x2="1284.479" y1="804.4983" y2="804.4983"/><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1;" width="6" x="980.52" y="815.2424"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="177.4951" x="992.52" y="822.0334">session: Optional[Session]</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="992.52" y="838.5217">&#160;</text><line style="stroke:#181818;stroke-width:1;" x1="973.52" x2="1284.479" y1="845.4748" y2="845.4748"/><ellipse cx="983.52" cy="859.219" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="240.4951" x="992.52" y="863.01">connect_to_server(path: str) : async</text><ellipse cx="983.52" cy="875.7073" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="286.959" x="992.52" y="879.4983">call_tool(tool_name: str, args: dict) : async</text></g><!--class LLMStreamAPI--><g class="entity" data-entity="LLMStreamAPI" data-source-line="64" data-uid="ent0010" id="entity_LLMStreamAPI"><rect fill="#F1F1F1" height="130.4414" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="275.1357" x="105.43" y="78.4883"/><ellipse cx="190.9852" cy="94.4883" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1;"/><path d="M187.4129,90.7534 L187.4129,88.5952 L194.7923,88.5952 L194.7923,90.7534 L192.327,90.7534 L192.327,98.8301 L194.7923,98.8301 L194.7923,100.9883 L187.4129,100.9883 L187.4129,98.8301 L189.8782,98.8301 L189.8782,90.7534 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="95.5254" x="211.4852" y="99.7793">LLMStreamAPI</text><line style="stroke:#181818;stroke-width:0.5;" x1="106.43" x2="379.5657" y1="110.4883" y2="110.4883"/><ellipse cx="116.43" cy="124.2324" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="189.5947" x="125.43" y="128.0234">POST /v1/chat/completions</text><ellipse cx="116.43" cy="140.7207" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83.0156" x="125.43" y="144.5117">stream: true</text><ellipse cx="116.43" cy="157.209" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="114.625" x="125.43" y="161">temperature: 0.7</text><ellipse cx="116.43" cy="173.6973" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="117.4482" x="125.43" y="177.4883">max_tokens: 100</text><ellipse cx="116.43" cy="190.1855" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="249.1357" x="125.43" y="193.9766">tools: [PLAY_SONG, CALL_CONTACT]</text><line style="stroke:#181818;stroke-width:0.5;" x1="106.43" x2="379.5657" y1="200.9297" y2="200.9297"/></g><g class="entity" data-entity="GMN11" data-source-line="74" data-uid="ent0012" id="entity_GMN11"><path d="M675.54,466.4783 L675.54,498.0983 L427.96,502.0983 L675.54,506.0983 L675.54,537.7205 A0,0 0 0 0 675.54,537.7205 L902.4643,537.7205 A0,0 0 0 0 902.4643,537.7205 L902.4643,476.4783 L892.4643,466.4783 L675.54,466.4783 A0,0 0 0 0 675.54,466.4783" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M892.4643,466.4783 L892.4643,476.4783 L902.4643,476.4783 L892.4643,466.4783" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="194.1558" x="681.54" y="484.0466">Manages LLM chat interactions</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205.9243" x="681.54" y="499.3572">Streams responses from LLM API</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152.2549" x="681.54" y="514.6677">Routes tool calls to MCP</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149.5381" x="681.54" y="529.9783">Handles audio playback</text></g><g class="entity" data-entity="GMN14" data-source-line="81" data-uid="ent0015" id="entity_GMN14"><path d="M1458.22,793.8483 L1458.22,865.0905 L1643.7766,865.0905 L1643.7766,803.8483 L1633.7766,793.8483 L1458.22,793.8483" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1633.7766,793.8483 L1633.7766,803.8483 L1643.7766,803.8483 L1633.7766,793.8483" fill="#FEFFDD" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="164.5566" x="1464.22" y="811.4166">Processes streaming data:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140.4673" x="1464.22" y="826.7272">- Buffers delta chunks</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151.5376" x="1464.22" y="842.0377">- Detects TOOL vs TEXT</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130.1587" x="1464.22" y="857.3483">- Routes to handlers</text></g><!--link StreamProcessor to GMN14--><g class="link" data-entity-1="StreamProcessor" data-entity-2="GMN14" data-source-line="81" data-uid="lnk16" id="link_StreamProcessor_GMN14"><path d="M536.51,739.0683 C584.12,707.8383 641.31,676.6983 698.5,660.7783 C775.89,639.2283 1349.45,625.2483 1421.5,660.7783 C1477.3,688.2883 1515.75,752.6683 1535.51,793.4583" fill="none" id="StreamProcessor-GMN14" style="stroke:#181818;stroke-width:1;stroke-dasharray:7,7;"/></g><!--link Helper to DMSLMMain--><g class="link" data-entity-1="Helper" data-entity-2="DMSLMMain" data-source-line="89" data-uid="lnk17" id="link_Helper_DMSLMMain"><path codeLine="89" d="M428.06,573.2383 C502.94,603.3883 586.62,642.3383 657,688.2783 C675.95,700.6483 690.216,711.5556 707.746,726.9056" fill="none" id="Helper-to-DMSLMMain" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="712.26,730.8583,708.1241,721.9199,708.4983,727.5644,702.8539,727.9386,712.26,730.8583" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="28.5645" x="636.64" y="676.8466">uses</text></g><!--link Helper to MCPClient--><g class="link" data-entity-1="Helper" data-entity-2="MCPClient" data-source-line="90" data-uid="lnk18" id="link_Helper_MCPClient"><path codeLine="90" d="M427.93,568.4283 C500.15,590.5283 582.32,614.3783 658,633.2783 C778.93,663.4683 818.65,638.6883 933,688.2783 C980.98,709.0783 1024.1526,739.2304 1060.5726,768.4904" fill="none" id="Helper-to-MCPClient" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="1065.25,772.2483,1060.7391,763.4932,1061.3521,769.1167,1055.7286,769.7298,1065.25,772.2483" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100.5024" x="914.19" y="676.8466">uses mcp_client</text></g><!--link Helper to LLMStreamAPI--><g class="link" data-entity-1="Helper" data-entity-2="LLMStreamAPI" data-source-line="91" data-uid="lnk19" id="link_Helper_LLMStreamAPI"><path codeLine="91" d="M152.74,370.5283 C143.05,338.2983 139.57,303.8583 150,271.9283 C157.26,249.6883 166.5094,232.9623 180.3094,214.0823" fill="none" id="Helper-to-LLMStreamAPI" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="183.85,209.2383,175.3098,214.1438,180.8995,213.2749,181.7684,218.8646,183.85,209.2383" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131.6504" x="151" y="285.4966">sends POST requests</text></g><!--link LLMStreamAPI to Helper--><g class="link" data-entity-1="LLMStreamAPI" data-entity-2="Helper" data-source-line="96" data-uid="lnk22" id="link_LLMStreamAPI_Helper"><path codeLine="96" d="M270,209.3183 C276.97,229.0583 283.49,251.0683 287,271.9283 C292.43,304.2383 289.9635,332.767 281.9735,364.767" fill="none" id="LLMStreamAPI-to-Helper" style="stroke:#181818;stroke-width:1;stroke-dasharray:7,7;"/><polygon fill="#181818" points="280.52,370.5883,286.5811,362.8254,281.7313,365.7372,278.8194,360.8874,280.52,370.5883" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160.6021" x="289.92" y="285.4966">streams response chunks</text></g><!--link Helper to StreamProcessor--><g class="link" data-entity-1="Helper" data-entity-2="StreamProcessor" data-source-line="92" data-uid="lnk20" id="link_Helper_StreamProcessor"><path codeLine="92" d="M302.79,633.5683 C323.98,669.0983 343.367,701.625 362.837,734.275" fill="none" id="Helper-to-StreamProcessor" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="365.91,739.4283,364.736,729.6496,363.3491,735.1339,357.8649,733.747,365.91,739.4283" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="127.8545" x="328.82" y="676.8466">delegates streaming</text></g><!--link MCPClient to MCPClient--><g class="link" data-entity-1="MCPClient" data-entity-2="MCPClient" data-source-line="94" data-uid="lnk21" id="link_MCPClient_MCPClient"><path codeLine="94" d="M1285.64,803.3183 C1306.57,807.7383 1320.48,816.4583 1320.48,829.4683 C1320.48,842.4883 1312.44,849.9559 1291.51,854.3859" fill="none" id="MCPClient-to-MCPClient" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="1285.64,855.6283,1295.2732,857.678,1290.5316,854.5929,1293.6167,849.8513,1285.64,855.6283" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108.3037" x="1326.48" y="834.5366">singleton pattern</text></g><!--link Helper to Helper--><g class="link" data-entity-1="Helper" data-entity-2="Helper" data-source-line="97" data-uid="lnk23" id="link_Helper_Helper"><path codeLine="97" d="M427.86,475.7383 C449.08,480.8883 462.68,489.6683 462.68,502.0983 C462.68,514.5283 454.9114,521.9058 433.6914,527.0458" fill="none" id="Helper-to-Helper" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="427.86,528.4583,437.5487,530.2271,432.7195,527.2812,435.6654,522.452,427.86,528.4583" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="183.479" x="468.68" y="507.1666">tool_check_CALL internal call</text></g><!--SRC=[ZLLjRzis4FwkNt78bofe7TiTXW82DY1pYdMORNcrYsue2e6cJpPXYTH8ocrGvB_lICaofJZ0v0-IUUztptEqmXO8imEpTzKZt6j-41QvhJL6KSNuaUqHRWvOLAXlu4SK0JsyOCR01tz8Pz0-8oYPa0ayBDRpnO8-0qcjYmICrV0BUREsIiRZwTjtTnFwJPEV9vF9-3GTSyfYp5LP5MY5akOcTArsU76nLsfVu7YFPSb6FuscRxSZONlglCfu8L3Q11QprSn_zkK9f9KBmueldSRNwA8pwZvVGvO9AMoMnOCARqETgc2FsJTsYdDHe6Gb-dJVW1KbPYhFt742UQ6O3UtmkzMCsymgLMJRGl5ZhD5KL7_Zu1P6lqBiFUq4xvaQoxJDg9Ru5X9Wvb7oGEeTyWFoOpQxdy_Zl2wARE3wkTKUpnufRDUOAufkMlFv8YxH64A9IQ0GnlPTFeM0MLkDh5nfnSb2zP5Zl2oZWYnsK_wq_7EPVbw6StrUWrCCDRPrdgCEHDSdMZLfK7zgUOm9MvPrBJafiGjKTsXHbq9YaruSH73Qz0gK3qpk2co6USupVjRqGOIp4K7X_nWzHKy1EIkcQK03SdO8xVEpDwf0u2AdjQrg-rUDDONqhq2X4iJrZDKxeR9_hwiyCCjU4E69Cdp9xfD1FMDoNI4x9h2bneMue8o9e-tvzL7o0Xbv8AIdyhtSfVcwCOflhtIBe3rerGNZFwu5xfP4w_Mb5S6LbEXfd5519zHnnUpXHPfnHa1sA8azL89rmVIU1kIfFk1IMCVzwe-k3Y49e3dZ2CJ7XcKa3ifv3QjqlO5hExQtJPnb0bO7yw4rWYNDdhah8O79tRj0LBBlLCCH9IKydKm6kuSElwpcz_zawtJv-njmEoYRfSlD_MppzLAHL1P1Y_t1Wihxbyg2IOTMLvNVDasXj2kxn9jY3PovOY3NglG6r06lyb7LbivTGhxfxjFDt0i_UE8PyC06jy2trE3dQLrVNUr_iczQ9-GUTiI296emz9jV50RyTW6_QKmhUa1tonhOfEaSJlH-__Uc5NK9jsj16vVFA_Y81VEL7qHbegZjr8Ysz8Ni2TIKJYWBDxYJ1JTZgDO33W4HvSuqeD58l3MsvtJOZiILY7jcmrP4qINsC1D3SWAWaa0aePdAAEfbCBeZWpPWqhgyJFdSoY2ZJdTmwJMG8VhwsKV_0G00]--></g></svg>