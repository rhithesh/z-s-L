<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="CLASS" height="863px" preserveAspectRatio="none" style="width:1727px;height:863px;background:#FFFFFF;" version="1.1" viewBox="0 0 1727 863" width="1727px" zoomAndPan="magnify"><title>PiperTTS - Text-to-Speech Pipeline</title><defs/><g><g class="title" data-source-line="1"><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="258.8359" x="727.2821" y="23.5352">PiperTTS - Text-to-Speech Pipeline</text></g><!--cluster pipertts--><g class="cluster" data-entity="pipertts" data-source-line="3" data-uid="ent0002" id="cluster_pipertts"><path d="M8.5,43.4883 L66.4365,43.4883 A3.75,3.75 0 0 1 68.9365,45.9883 L75.9365,65.9766 L610.5,65.9766 A2.5,2.5 0 0 1 613,68.4766 L613,585.1783 A2.5,2.5 0 0 1 610.5,587.6783 L8.5,587.6783 A2.5,2.5 0 0 1 6,585.1783 L6,45.9883 A2.5,2.5 0 0 1 8.5,43.4883" fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="6" x2="75.9365" y1="65.9766" y2="65.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="56.9365" x="10" y="59.0234">pipertts</text></g><!--cluster parent--><g class="cluster" data-entity="parent" data-source-line="42" data-uid="ent0006" id="cluster_parent"><path d="M639.5,397.9983 L687.4424,397.9983 A3.75,3.75 0 0 1 689.9424,400.4983 L696.9424,420.4866 L874.5,420.4866 A2.5,2.5 0 0 1 877,422.9866 L877,576.9383 A2.5,2.5 0 0 1 874.5,579.4383 L639.5,579.4383 A2.5,2.5 0 0 1 637,576.9383 L637,400.4983 A2.5,2.5 0 0 1 639.5,397.9983" fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="637" x2="696.9424" y1="420.4866" y2="420.4866"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="46.9424" x="641" y="413.5334">parent</text></g><!--cluster config--><g class="cluster" data-entity="config" data-source-line="53" data-uid="ent0008" id="cluster_config"><path d="M903.5,422.7283 L949.6787,422.7283 A3.75,3.75 0 0 1 952.1787,425.2283 L959.1787,445.2166 L1066.5,445.2166 A2.5,2.5 0 0 1 1069,447.7166 L1069,552.2083 A2.5,2.5 0 0 1 1066.5,554.7083 L903.5,554.7083 A2.5,2.5 0 0 1 901,552.2083 L901,425.2283 A2.5,2.5 0 0 1 903.5,422.7283" fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="901" x2="959.1787" y1="445.2166" y2="445.2166"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="45.1787" x="905" y="438.2634">config</text></g><!--cluster External API--><g class="cluster" data-entity="External API" data-source-line="61" data-uid="ent0010" id="cluster_External API"><path d="M322.5,658.0783 L410.5488,658.0783 A3.75,3.75 0 0 1 413.0488,660.5783 L420.0488,680.5666 L575.5,680.5666 A2.5,2.5 0 0 1 578,683.0666 L578,853.5083 A2.5,2.5 0 0 1 575.5,856.0083 L322.5,856.0083 A2.5,2.5 0 0 1 320,853.5083 L320,660.5783 A2.5,2.5 0 0 1 322.5,658.0783" fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="320" x2="420.0488" y1="680.5666" y2="680.5666"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="87.0488" x="324" y="673.6134">External API</text></g><!--class PiperTTS--><g class="entity" data-entity="PiperTTS" data-source-line="5" data-uid="ent0003" id="entity_PiperTTS"><rect fill="#F1F1F1" height="245.8594" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="418.4102" x="178.79" y="78.4883"/><ellipse cx="354.06" cy="94.4883" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1;"/><path d="M356.5332,100.6313 Q355.9521,100.9302 355.3129,101.0796 Q354.6738,101.229 353.9682,101.229 Q351.4614,101.229 350.1416,99.5771 Q348.8217,97.9253 348.8217,94.8042 Q348.8217,91.6748 350.1416,90.0229 Q351.4614,88.3711 353.9682,88.3711 Q354.6738,88.3711 355.3212,88.5205 Q355.9687,88.6699 356.5332,88.9688 L356.5332,91.6914 Q355.9023,91.1104 355.3088,90.8406 Q354.7153,90.5708 354.0844,90.5708 Q352.7397,90.5708 352.0549,91.6375 Q351.3701,92.7041 351.3701,94.8042 Q351.3701,96.896 352.0549,97.9626 Q352.7397,99.0293 354.0844,99.0293 Q354.7153,99.0293 355.3088,98.7595 Q355.9023,98.4897 356.5332,97.9087 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59.3701" x="374.56" y="99.7793">PiperTTS</text><line style="stroke:#181818;stroke-width:0.5;" x1="179.79" x2="596.2002" y1="110.4883" y2="110.4883"/><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1;" width="6" x="186.79" y="121.2324"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="124.5303" x="198.79" y="128.0234">main: DMSLMMain</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1;" width="6" x="186.79" y="137.7207"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="188.8633" x="198.79" y="144.5117">stop_event: threading.Event</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1;" width="6" x="186.79" y="154.209"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="185.5957" x="198.79" y="161">audio_queue: queue.Queue</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1;" width="6" x="186.79" y="170.6973"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="392.4102" x="198.79" y="177.4883">TTS_URL: str = "http://127.0.0.1:5000/v1/audio/speech"</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1;" width="6" x="186.79" y="187.1855"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="208.0381" x="198.79" y="193.9766">text_processor_thread: Thread</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1;" width="6" x="186.79" y="203.6738"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="193.7783" x="198.79" y="210.4648">audio_player_thread: Thread</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="198.79" y="226.9531">&#160;</text><line style="stroke:#181818;stroke-width:1;" x1="179.79" x2="596.2002" y1="233.9063" y2="233.9063"/><ellipse cx="189.79" cy="247.6504" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="183.6543" x="198.79" y="251.4414">__init__(main: DMSLMMain)</text><ellipse cx="189.79" cy="264.1387" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="144.3408" x="198.79" y="267.9297">_process_text() : void</text><ellipse cx="189.79" cy="280.627" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="187.7285" x="198.79" y="284.418">_tts_request(text: str) : void</text><ellipse cx="189.79" cy="297.1152" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="130.8809" x="198.79" y="300.9063">_play_audio() : void</text><ellipse cx="189.79" cy="313.6035" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88.8535" x="198.79" y="317.3945">finish() : void</text></g><!--class TextProcessor--><g class="entity" data-entity="TextProcessor" data-source-line="21" data-uid="ent0004" id="entity_TextProcessor"><rect fill="#F1F1F1" height="146.9297" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="244.9688" x="21.52" y="424.7483"/><ellipse cx="91.6977" cy="440.7483" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1;"/><path d="M94.1709,446.8913 Q93.5898,447.1902 92.9507,447.3396 Q92.3115,447.489 91.6059,447.489 Q89.0991,447.489 87.7793,445.8371 Q86.4595,444.1853 86.4595,441.0642 Q86.4595,437.9348 87.7793,436.2829 Q89.0991,434.6311 91.6059,434.6311 Q92.3115,434.6311 92.959,434.7805 Q93.6064,434.9299 94.1709,435.2288 L94.1709,437.9514 Q93.54,437.3704 92.9465,437.1006 Q92.353,436.8308 91.7221,436.8308 Q90.3774,436.8308 89.6926,437.8975 Q89.0078,438.9641 89.0078,441.0642 Q89.0078,443.156 89.6926,444.2226 Q90.3774,445.2893 91.7221,445.2893 Q92.353,445.2893 92.9465,445.0195 Q93.54,444.7497 94.1709,444.1687 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96.1133" x="112.1977" y="446.0393">TextProcessor</text><line style="stroke:#181818;stroke-width:0.5;" x1="22.52" x2="265.4888" y1="456.7483" y2="456.7483"/><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1;" width="6" x="29.52" y="467.4924"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="68.2842" x="41.52" y="474.2834">buffer: str</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1;" width="6" x="29.52" y="483.9807"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="218.9688" x="41.52" y="490.7717">sentence_re: regex = r"(.+?[.!?])"</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="41.52" y="507.26">&#160;</text><line style="stroke:#181818;stroke-width:1;" x1="22.52" x2="265.4888" y1="514.2131" y2="514.2131"/><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1;" width="6" x="29.52" y="524.9573"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="140.123" x="41.52" y="531.7483">collect_chunks() : str</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1;" width="6" x="29.52" y="541.4455"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="218.1553" x="41.52" y="548.2366">detect_sentence(buffer: str) : str</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1;" width="6" x="29.52" y="557.9338"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="155.3057" x="41.52" y="564.7248">extract_sentence() : str</text></g><!--class TTSRequestHandler--><g class="entity" data-entity="TTSRequestHandler" data-source-line="31" data-uid="ent0005" id="entity_TTSRequestHandler"><rect fill="#F1F1F1" height="146.9297" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="295.377" x="301.31" y="424.7483"/><ellipse cx="378.416" cy="440.7483" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1;"/><path d="M380.8891,446.8913 Q380.308,447.1902 379.6689,447.3396 Q379.0297,447.489 378.3242,447.489 Q375.8173,447.489 374.4975,445.8371 Q373.1777,444.1853 373.1777,441.0642 Q373.1777,437.9348 374.4975,436.2829 Q375.8173,434.6311 378.3242,434.6311 Q379.0297,434.6311 379.6772,434.7805 Q380.3246,434.9299 380.8891,435.2288 L380.8891,437.9514 Q380.2582,437.3704 379.6647,437.1006 Q379.0712,436.8308 378.4404,436.8308 Q377.0956,436.8308 376.4108,437.8975 Q375.726,438.9641 375.726,441.0642 Q375.726,443.156 376.4108,444.2226 Q377.0956,445.2893 378.4404,445.2893 Q379.0712,445.2893 379.6647,445.0195 Q380.2582,444.7497 380.8891,444.1687 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="132.665" x="398.916" y="446.0393">TTSRequestHandler</text><line style="stroke:#181818;stroke-width:0.5;" x1="302.31" x2="595.687" y1="456.7483" y2="456.7483"/><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1;" width="6" x="309.31" y="467.4924"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85.2236" x="321.31" y="474.2834">TTS_URL: str</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1;" width="6" x="309.31" y="483.9807"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="200.6758" x="321.31" y="490.7717">response_format: str = "pcm"</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4297" x="321.31" y="507.26">&#160;</text><line style="stroke:#181818;stroke-width:1;" x1="302.31" x2="595.687" y1="514.2131" y2="514.2131"/><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1;" width="6" x="309.31" y="524.9573"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="195.9316" x="321.31" y="531.7483">build_payload(text: str) : dict</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1;" width="6" x="309.31" y="541.4455"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="269.377" x="321.31" y="548.2366">make_request(payload: dict) : Response</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1;" width="6" x="309.31" y="557.9338"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="205.8301" x="321.31" y="564.7248">stream_audio_chunks() : bytes</text></g><!--class DMSLMMain--><g class="entity" data-entity="DMSLMMain" data-source-line="44" data-uid="ent0007" id="entity_DMSLMMain"><rect fill="#F1F1F1" height="130.4414" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="207.5762" x="653.21" y="432.9983"/><ellipse cx="711.6812" cy="448.9983" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1;"/><path d="M714.1543,455.1413 Q713.5733,455.4402 712.9341,455.5896 Q712.295,455.739 711.5894,455.739 Q709.0826,455.739 707.7627,454.0871 Q706.4429,452.4353 706.4429,449.3142 Q706.4429,446.1848 707.7627,444.5329 Q709.0826,442.8811 711.5894,442.8811 Q712.295,442.8811 712.9424,443.0305 Q713.5899,443.1799 714.1543,443.4788 L714.1543,446.2014 Q713.5235,445.6204 712.93,445.3506 Q712.3365,445.0808 711.7056,445.0808 Q710.3609,445.0808 709.6761,446.1475 Q708.9913,447.2141 708.9913,449.3142 Q708.9913,451.406 709.6761,452.4726 Q710.3609,453.5393 711.7056,453.5393 Q712.3365,453.5393 712.93,453.2695 Q713.5235,452.9997 714.1543,452.4187 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82.1338" x="732.1812" y="454.2893">DMSLMMain</text><line style="stroke:#181818;stroke-width:0.5;" x1="654.21" x2="859.7862" y1="464.9983" y2="464.9983"/><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1;" width="6" x="661.21" y="475.7424"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="170.96" x="673.21" y="482.5334">textOutputQueue: Queue</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1;" width="6" x="661.21" y="492.2307"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="181.5762" x="673.21" y="499.0217">piper_audio_queue: Queue</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1;" width="6" x="661.21" y="508.719"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="125.6855" x="673.21" y="515.51">Dataqueue: Queue</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1;" width="6" x="661.21" y="525.2073"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="147.1572" x="673.21" y="531.9983">last_active_time: float</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1;" width="6" x="661.21" y="541.6955"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="135.4541" x="673.21" y="548.4866">UserCanSpeak: bool</text><line style="stroke:#181818;stroke-width:0.5;" x1="654.21" x2="859.7862" y1="555.4397" y2="555.4397"/></g><!--class voice_message--><g class="entity" data-entity="voice_message" data-source-line="55" data-uid="ent0009" id="entity_voice_message"><rect fill="#F1F1F1" height="80.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="136.8994" x="916.55" y="457.7283"/><ellipse cx="933.1843" cy="473.7283" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1;"/><path d="M935.6575,479.8713 Q935.0764,480.1702 934.4373,480.3196 Q933.7981,480.469 933.0925,480.469 Q930.5857,480.469 929.2659,478.8171 Q927.946,477.1653 927.946,474.0442 Q927.946,470.9148 929.2659,469.2629 Q930.5857,467.6111 933.0925,467.6111 Q933.7981,467.6111 934.4456,467.7605 Q935.093,467.9099 935.6575,468.2088 L935.6575,470.9314 Q935.0266,470.3504 934.4331,470.0806 Q933.8396,469.8108 933.2087,469.8108 Q931.864,469.8108 931.1792,470.8775 Q930.4944,471.9441 930.4944,474.0442 Q930.4944,476.136 931.1792,477.2026 Q931.864,478.2693 933.2087,478.2693 Q933.8396,478.2693 934.4331,477.9995 Q935.0266,477.7297 935.6575,477.1487 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="101.2676" x="947.5475" y="479.0193">voice_message</text><line style="stroke:#181818;stroke-width:0.5;" x1="917.55" x2="1052.4494" y1="489.7283" y2="489.7283"/><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1;" width="6" x="924.55" y="500.4724"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85.3262" x="936.55" y="507.2634">request: dict</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1;" width="6" x="924.55" y="516.9607"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="110.8994" x="936.55" y="523.7517">parameters: dict</text><line style="stroke:#181818;stroke-width:0.5;" x1="917.55" x2="1052.4494" y1="530.7048" y2="530.7048"/></g><!--class PiperTTSAPI--><g class="entity" data-entity="PiperTTSAPI" data-source-line="63" data-uid="ent0011" id="entity_PiperTTSAPI"><rect fill="#F1F1F1" height="146.9297" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="226.6758" x="335.66" y="693.0783"/><ellipse cx="404.3475" cy="709.0783" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1;"/><path d="M400.7752,705.3434 L400.7752,703.1852 L408.1546,703.1852 L408.1546,705.3434 L405.6893,705.3434 L405.6893,713.4201 L408.1546,713.4201 L408.1546,715.5783 L400.7752,715.5783 L400.7752,713.4201 L403.2406,713.4201 L403.2406,705.3434 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="80.8008" x="424.8475" y="714.3693">PiperTTSAPI</text><line style="stroke:#181818;stroke-width:0.5;" x1="336.66" x2="561.3358" y1="725.0783" y2="725.0783"/><ellipse cx="346.66" cy="738.8224" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="162.8457" x="355.66" y="742.6134">POST /v1/audio/speech</text><ellipse cx="346.66" cy="755.3107" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="62.4326" x="355.66" y="759.1017">input: str</text><ellipse cx="346.66" cy="771.799" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61.8242" x="355.66" y="775.59">voice: str</text><ellipse cx="346.66" cy="788.2873" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89.1064" x="355.66" y="792.0783">language: str</text><ellipse cx="346.66" cy="804.7755" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="200.6758" x="355.66" y="808.5666">response_format: str = "pcm"</text><line style="stroke:#181818;stroke-width:0.5;" x1="336.66" x2="561.3358" y1="815.5197" y2="815.5197"/><ellipse cx="346.66" cy="829.2638" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="193.0195" x="355.66" y="833.0548">Returns: audio stream (PCM)</text></g><g class="entity" data-entity="GMN12" data-source-line="74" data-uid="ent0013" id="entity_GMN12"><path d="M1088.92,401.3483 L1088.92,595.0748 L1407.0792,595.0748 L1407.0792,411.3483 L1397.0792,401.3483 L1088.92,401.3483" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1397.0792,401.3483 L1397.0792,411.3483 L1407.0792,411.3483 L1397.0792,401.3483" fill="#FEFFDD" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="232.3306" x="1094.92" y="418.9166">Text Buffering &amp; Sentence Detection:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="1094.92" y="434.2272">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="202.1475" x="1094.92" y="449.5377">1. Reads from textOutputQueue</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="204.2993" x="1094.92" y="464.8483">2. Accumulates chunks in buffer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="297.1592" x="1094.92" y="480.1588">3. Uses regex pattern to detect sentences (. ! ?)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="189.2808" x="1094.92" y="495.4694">4. Extracts complete sentence</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98.084" x="1094.92" y="510.7799">5. Sends to TTS</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="230.7119" x="1094.92" y="526.0905">6. None signal = flush buffer &amp; send</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="1094.92" y="541.401">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83.2305" x="1094.92" y="556.7116">Performance:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="226.3511" x="1094.92" y="572.0221">- Measures sentence detection time</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="232.3496" x="1094.92" y="587.3327">- Measures TTS latency per sentence</text></g><g class="entity" data-entity="GMN15" data-source-line="89" data-uid="ent0016" id="entity_GMN15"><path d="M1441.59,401.3483 L1441.59,595.0748 L1720.4001,595.0748 L1720.4001,411.3483 L1710.4001,401.3483 L1441.59,401.3483" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1710.4001,401.3483 L1710.4001,411.3483 L1720.4001,411.3483 L1710.4001,401.3483" fill="#FEFFDD" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119.4058" x="1447.59" y="418.9166">HTTP TTS Request:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="1447.59" y="434.2272">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="195.7935" x="1447.59" y="449.5377">1. Build JSON payload with text</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="201.1382" x="1447.59" y="464.8483">2. Stream POST to Piper TTS API</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="183.5171" x="1447.59" y="480.1588">3. Receive PCM audio chunks</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="247.1016" x="1447.59" y="495.4694">4. Queue chunks to piper_audio_queue</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="1447.59" y="510.7799">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96.8652" x="1447.59" y="526.0905">Output Signals:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171.2217" x="1447.59" y="541.401">- Audio chunks: PCM bytes</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97.8047" x="1447.59" y="556.7116">- End signal: b"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" text-decoration="underline" textLength="56.3291" x="1545.3947" y="556.7116">TTS_END</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.856" x="1601.7238" y="556.7116">"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="257.8101" x="1447.59" y="572.0221">- Also puts voice_message to Dataqueue</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166.8862" x="1447.59" y="587.3327">- Updates last_active_time</text></g><!--link TextProcessor to GMN12--><g class="link" data-entity-1="TextProcessor" data-entity-2="GMN12" data-source-line="74" data-uid="lnk14" id="link_TextProcessor_GMN12"><path d="M205.05,424.3783 C231.59,397.8883 264.99,371.1283 301.5,357.1783 C379.34,327.4183 972.17,331.6483 1051.5,357.1783 C1081.48,366.8183 1110.76,382.9183 1137.18,400.8583" fill="none" id="TextProcessor-GMN12" style="stroke:#181818;stroke-width:1;stroke-dasharray:7,7;"/></g><!--link TTSRequestHandler to GMN15--><g class="link" data-entity-1="TTSRequestHandler" data-entity-2="GMN15" data-source-line="89" data-uid="lnk17" id="link_TTSRequestHandler_GMN15"><path d="M531.87,424.4383 C567.12,397.7783 610.28,370.8883 654.5,357.1783 C734.41,332.3883 1328.66,329.1683 1407.5,357.1783 C1434.93,366.9183 1461.19,383.0583 1484.59,401.0083" fill="none" id="TTSRequestHandler-GMN15" style="stroke:#181818;stroke-width:1;stroke-dasharray:7,7;"/></g><!--reverse link PiperTTS to TextProcessor--><g class="link" data-entity-1="PiperTTS" data-entity-2="TextProcessor" data-source-line="105" data-uid="lnk18" id="link_PiperTTS_TextProcessor"><path codeLine="105" d="M279.3391,333.7029 C251.1591,367.7529 229.08,394.4283 204.07,424.6383" fill="none" id="PiperTTS-backto-TextProcessor" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="286.99,324.4583,280.083,326.5303,279.3391,333.7029,286.2461,331.6309,286.99,324.4583" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="28.5645" x="259.68" y="367.9166">uses</text></g><!--reverse link PiperTTS to TTSRequestHandler--><g class="link" data-entity-1="PiperTTS" data-entity-2="TTSRequestHandler" data-source-line="106" data-uid="lnk19" id="link_PiperTTS_TTSRequestHandler"><path codeLine="106" d="M321.3466,336.5773 C319.2866,352.3573 321.95,356.3383 328,371.3483 C335.76,390.6083 348.03,408.5783 361.84,424.5583" fill="none" id="PiperTTS-backto-TTSRequestHandler" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="322.9,324.6783,318.157,330.11,321.3466,336.5773,326.0897,331.1456,322.9,324.6783" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="28.5645" x="329" y="367.9166">uses</text></g><!--link TTSRequestHandler to PiperTTSAPI--><g class="link" data-entity-1="TTSRequestHandler" data-entity-2="PiperTTSAPI" data-source-line="107" data-uid="lnk20" id="link_TTSRequestHandler_PiperTTSAPI"><path codeLine="107" d="M449,571.9883 C449,609.5683 449,649.2883 449,686.8583" fill="none" id="TTSRequestHandler-to-PiperTTSAPI" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="449,692.8583,453,683.8583,449,687.8583,445,683.8583,449,692.8583" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="69.7988" x="450" y="638.6466">HTTP POST</text></g><!--link PiperTTS to voice_message--><g class="link" data-entity-1="PiperTTS" data-entity-2="voice_message" data-source-line="108" data-uid="lnk21" id="link_PiperTTS_voice_message"><path codeLine="108" d="M597.66,235.1483 C691.42,257.3683 799.39,294.1183 883,354.3483 C919.97,380.9783 945.6908,419.9479 963.0708,452.1579" fill="none" id="PiperTTS-to-voice_message" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="965.92,457.4383,965.1664,447.6183,963.5457,453.038,958.126,451.4172,965.92,457.4383" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65.7427" x="902.24" y="367.9166">references</text></g><!--link PiperTTS to DMSLMMain--><g class="link" data-entity-1="PiperTTS" data-entity-2="DMSLMMain" data-source-line="110" data-uid="lnk22" id="link_PiperTTS_DMSLMMain"><path codeLine="110" d="M374.81,324.7883 C378.39,342.1883 385.5,358.5083 398,371.3483 C431.44,405.7283 568.17,372.9583 613,389.9983 C639.08,399.9083 659.7385,412.3737 681.8085,429.1037" fill="none" id="PiperTTS-to-DMSLMMain" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="686.59,432.7283,681.8342,424.1038,682.6054,429.7078,677.0014,430.4791,686.59,432.7283" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148.4653" x="399" y="367.9166">reads textOutputQueue</text></g><!--link PiperTTS to DMSLMMain--><g class="link" data-entity-1="PiperTTS" data-entity-2="DMSLMMain" data-source-line="111" data-uid="lnk23" id="link_PiperTTS_DMSLMMain"><path codeLine="111" d="M530.78,324.8383 C549.87,340.6683 569.31,356.5183 588,371.3483 C589.12,372.2383 624.6272,398.6854 665.5972,429.1854" fill="none" id="PiperTTS-to-DMSLMMain-1" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="670.41,432.7683,665.5794,424.1854,666.3993,429.7826,660.8022,430.6025,670.41,432.7683" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161.5986" x="589" y="367.9166">writes piper_audio_queue</text></g><!--link PiperTTS to DMSLMMain--><g class="link" data-entity-1="PiperTTS" data-entity-2="DMSLMMain" data-source-line="112" data-uid="lnk24" id="link_PiperTTS_DMSLMMain"><path codeLine="112" d="M597.25,242.7883 C658.2,265.2383 718.22,300.1383 755,354.3483 C770.32,376.9283 773.3163,400.4972 771.2163,426.8672" fill="none" id="PiperTTS-to-DMSLMMain-2" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="770.74,432.8483,775.4418,424.1942,771.1369,427.8641,767.4671,423.5591,770.74,432.8483" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109.7002" x="764.72" y="367.9166">writes Dataqueue</text></g><!--SRC=[XLPTRzis57tthxZrG-Sqa9nqxGO8Q8EqCT0DTU9QpbDH48n4MKGaKYEfD47G_xvBIfOeoTaS83R8e_jnphdNDjmK33QyOcgtYo607NiqWP51N36MvEwcu8BDPXLDxkcUmRooO6Fq79vdCy1NKb2j-nZFxj2-0YWf5n5ShUElwpL-z6wqaHLX3qoO24ok64svs8ShU-2XQ9roIVwfMSqYS6_XD_lVWs1AShlz6c541HzWdXjJHSlb-Ti_mpFyEu_UdvsTBH_EboxMKhk-vbu0WnsJIic4QIqLQOg9OEVU9xLK1NrY4rGF2xgFfq085zmGiXZHSE9Zsip4bh4uWGWU94zz059D5CFcjLbOaElq6D2MHboLn-9aM8lEXpU_V06jyfi33GCLx-eiOyhbzHL4gPX861ONWM9xzeZqg_aYFBtu7hww-74oFqfB08ai2fOOakIrkDUkec7ab1bxVqYmyF9FmLYreZxQXmmRtCNRXiSlLAG56pRf-yWxLanNKcX6CgbAQZgRLKdvKdztDIzIKj6dGj9qA5dA4pCOZtlMQTi-q80iUDkc7amDsgriHFRvktioJBST__9dbIgaPJIfdGy7_TiwRsfJrUPRCsxZGNDpJmOJEOPSKKDVkCBCXg1E_84Hmqj4PDYjJyQjPkep5RXuw3rs96LnfA54YeplHmsXdz669HhNOfu7wZbk9yGZBxH4bodjNGqphHxnMj02BZT_TVauUanbDEbN9jvw6KzXSnFlOBnkl7ikaE6XoKwR1iQ71HNx6aiPd_-d8tlObfbQ2UpF5T8w1nQRp-kJlbiX3GF5zxa1cHtT0FOCFha1n0KDho5kvmokt9HoAQA6c_CGSz9KGwPaERQJGxmDuJ99wh8kADeL6lyY8-s2SPZVGsi4tIwKYXgh0XZPBeLkwsXOXF0ABffcteMmQlO0XfLbLI2uWph4-z1MZjLXA9JDdVqHmhKK2EHxA_G7j6IjyxOQR1K3jAjzWwfRjZ5QD6iij6PKrwX5bwQj40a1Q_0np7urshv5yWHedRwwgGmlxAalkzt6XMblUzu_sOq3VyStrz1k4VZ9JUv4E30VDmPm_aGEd7zTD7JmWVajInWEAA19Mjiq6XquTb8UTCCWavNGLDJe3h6ZLHy8k_G2HYv5lxK2M8cqrG5dVqw8NSUhwoj2veV72uq9QpCUTooZMpijzBPAdS76EyTI_HisYJAWIZhdbPxDkjyjRu9WD04Hr6Z54M8YJekQNWJ1ny6QY1e5hG9zJ0iQDcI_JD5_pkIp8R3Vt1PaPsqyPY_2VofkAPagzdzFzEJ-2m00]--></g></svg>